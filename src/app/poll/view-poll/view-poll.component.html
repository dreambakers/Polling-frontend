<div class="h-100" [class.p-5]="!embeddedPreview"
     *ngIf="poll?.questions && poll?.status !== constants.statusTypes.deleted">

  <div class="mb-5" *ngIf="poll.status === constants.statusTypes.terminated">
    <small>
      {{ 'messages.cannotRespondPollTerminated' | translate }}
    </small>
  </div>

  <h4>{{poll.title}}</h4>
  <p>{{poll.description}}</p>

  <p class="font-italic" *ngIf="poll.activeComment && (poll.status === constants.statusTypes.open)">
    {{ poll.activeComment }}
  </p>

  <p class="font-italic" *ngIf="poll.inactiveComment && (poll.status !== constants.statusTypes.open)">
    {{ poll.inactiveComment }}
  </p>

  <mat-card *ngFor="let question of (hasResponded ? response.questions : poll.questions); let i = index"
            class="border my-5 p-3">
    <h3 class="mb-5 ml-1">
      {{ 'labels.question' | translate }}
      {{i + 1}}:
      {{question.text}}
    </h3>

    <ul class="list-group" *ngFor="let option of getOptions(question); let j = index">
      <li class="list-group-item mt-2"
          [ngClass]="(question.answerType !== constants.answerTypes.text) &&
                      'd-flex justify-content-between align-items-center'">
        <div class="font-weight-bold">
          {{ hasResponded ? option.option : option }}
        </div>
        <ng-container *ngTemplateOutlet="questions; context: { question: question, i: i, j: j, answerObj: option}">
        </ng-container>
      </li>
    </ul>

    <!-- Question without any options -->
    <div *ngIf="!getOptions(question).length" [ngSwitch]="question.answerType">
      <ng-container *ngTemplateOutlet="questions; context: { question: question, i: i, j: null, answerObj: question }">
      </ng-container>
    </div>

    <ng-template #questions let-question='question' let-i="i" let-j="j" let-answerObj="answerObj">

      <div [ngSwitch]="question.answerType">
        <div *ngSwitchCase="constants.answerTypes.binary">
          <mat-button-toggle-group #group="matButtonToggleGroup" (change)="onBinaryAnswerChanged($event, i, j)"
            [value]="answerObj.answer" [disabled]="shouldDisable">
            <mat-button-toggle value="yes">
              {{ 'answers.yes' | translate }}
            </mat-button-toggle>
            <mat-button-toggle value="no">
              {{ 'answers.no' | translate }}
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <div *ngSwitchCase="constants.answerTypes.radioButton">
          <mat-radio-group name="{{i}}" [disabled]="shouldDisable">
            <mat-radio-button [checked]="answerObj.answer" value=""
            (change)="onRadioButtonChanged(i, j)">
            </mat-radio-button>
          </mat-radio-group>
        </div>

        <div *ngSwitchCase="constants.answerTypes.checkbox">
          <mat-checkbox (change)="onCheckboxChanged($event, i, j)"
                        [checked]="answerObj.answer"
                        [disabled]="shouldDisable">
          </mat-checkbox>
        </div>

        <div *ngSwitchCase="constants.answerTypes.yesNoMaybe">
          <mat-button-toggle-group #group="matButtonToggleGroup" (change)="onYNMAnswerChanged($event, i, j)"
            [value]="answerObj.answer" [disabled]="shouldDisable">
            <mat-button-toggle value="yes">
              {{ 'answers.yes' | translate }}
            </mat-button-toggle>
            <mat-button-toggle value="no">
              {{ 'answers.no' | translate }}
            </mat-button-toggle>
            <mat-button-toggle value="maybe">
              {{ 'answers.maybe' | translate }}
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <div *ngSwitchCase="constants.answerTypes.smiley">
          <mat-button-toggle-group #group="matButtonToggleGroup" (change)="onSmileyAnswerChanged($event, i, j)"
            [value]="answerObj.answer" [disabled]="shouldDisable" id="smiley">
            <mat-button-toggle value="sad">
              <i class="fas fa-frown" style="color: #f44336"></i>
            </mat-button-toggle>
            <mat-button-toggle value="medium">
              <i class="fas fa-meh" style="color: #ffc107"></i>
            </mat-button-toggle>
            <mat-button-toggle value="happy">
              <i class="fas fa-smile" style="color: #4caf50"></i>
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <div *ngSwitchCase="constants.answerTypes.rating">
          <app-star-rating [rating]="answerObj.answer" [starCount]="starCount"
            [color]="starColor" (ratingUpdated)="onRatingChanged($event, i, j)" [disabled]="shouldDisable"
            class="text-nowrap">
          </app-star-rating>
        </div>

        <div *ngSwitchCase="constants.answerTypes.slider" class="d-flex flex-row align-items-center">
          <mat-slider #slider
          [value]="answerObj.answer"
          [disabled]="shouldDisable"
          [max]="100"
          [min]="0"
          [step]="1"
          [thumbLabel]="true"
          (change)="onSliderValueChanged($event, i, j)">
          </mat-slider>
          <span class="text-center ml-2 border p-2 slider-box">{{ slider.value }}</span>
        </div>

        <div *ngSwitchCase="constants.answerTypes.text" class="mt-3">
          <textarea matInput placeholder="{{ 'placeholders.textAnswer' | translate }}"
                    (input)="onTextAnswerChanged($event, i, j)" maxlength="500" rows="4"
                    [value]="answerObj.answer || (hasResponded ? translate.instant('messages.noAnswer') : '')"
                    [disabled]="shouldDisable" [class.font-italic]="this.preview && !answerObj.answer">
          </textarea>
        </div>
      </div>

    </ng-template>

  </mat-card>

  <mat-card *ngIf="poll?.allowComments || poll?.allowNames">
    <mat-form-field appearance="outline" class="w-100 mb-2" *ngIf="poll.allowNames">
      <mat-label>
        {{ 'labels.name' | translate }}
      </mat-label>
      <input matInput placeholder="{{ 'placeholders.name' | translate }}" [(ngModel)]="response.name">
      <mat-hint>
        {{ 'hints.enterName' | translate }}
      </mat-hint>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100 mb-2" *ngIf="poll.allowComments">
      <mat-label>{{ 'labels.comments' | translate }}</mat-label>
      <textarea matInput placeholder="{{ 'placeholders.comment' | translate }}"
                [(ngModel)]="response.comments">
      </textarea>
      <mat-hint>{{ 'hints.enterComments' | translate }}</mat-hint>
    </mat-form-field>
  </mat-card>

  <div class="text-center mt-5" *ngIf="!preview">
    <button class="btn btn-danger mr-2" (click)="navigateToRespond()">
      {{ 'labels.back' | translate }}
    </button>

    <button class="btn btn-success" (click)="vote()" [disabled]="!canVote || !dirty"
            *ngIf="!shouldDisable">
      {{ (hasResponded)
          ? translate.instant('labels.update') :
            !(canVote) ? translate.instant('messages.selectAllOptions')  : translate.instant('labels.vote')
      }}
    </button>
  </div>
</div>

<div class="d-flex justify-content-center align-items-center p-5 flex-column"
  *ngIf="poll?.status === constants.statusTypes.deleted">
  <mat-card class="d-flex flex-column justify-content-center text-center m-5 p-5 w-75">
    <h4>{{ 'messages.pollDeleted' | translate }}</h4>
    <small class="font-italic my-3" *ngIf="poll.inactiveComment">
      {{ poll.inactiveComment }}
    </small>
    <div>
      <button class="btn btn-danger mr-2" (click)="navigateToRespond()">
        {{ 'labels.back' | translate }}
      </button>
    </div>
  </mat-card>
</div>

<div *ngIf="passwordRequired" class="d-flex justify-content-center">
  <mat-card class="d-flex flex-column justify-content-center m-5 p-5 w-75">
    <h4 class="text-center">{{ 'messages.providePassword' | translate }}</h4>

    <mat-form-field appearance="outline" class=" mt-5">
      <mat-label>{{ 'labels.password' | translate }}</mat-label>
      <input matInput placeholder="{{ 'placeholders.pollPassword' | translate }}" [(ngModel)]="password"
             [type]="hide ? 'password' : 'text'" (keyup.enter)="goClicked()">
      <mat-icon matSuffix (click)="hide = !hide" class="cursor-pointer">
          {{hide ? 'visibility_off' : 'visibility'}}
      </mat-icon>
    </mat-form-field>

    <div class="d-flex justify-content-center">
      <button class="btn btn-danger mr-2" (click)="navigateToRespond()">
        {{ 'labels.back' | translate }}
      </button>
      <button class="btn btn-primary" (click)="goClicked()" [disabled]="!password">
        {{ 'labels.go' | translate }}
      </button>
    </div>
  </mat-card>
</div>
